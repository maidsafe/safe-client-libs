FROM rust:1.29.2

WORKDIR /usr/src/crust
COPY . .

# Running the package script with --help caches the dependencies for the script.
RUN apt-get update -y && \
    mkdir /target && \
    apt-get clean -y && \
    rm -rf /var/lib/apt/lists/* && \
    cargo install cargo-script && \
    ./scripts/build-real /target && \
    ./scripts/package.rs --help && \
    find /target/release/ -maxdepth 1 -type f -exec rm '{}' \;
